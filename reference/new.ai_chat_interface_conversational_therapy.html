<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat - B·∫°n Th∆∞∆°ng | Tr√≤ chuy·ªán v·ªõi AI</title>
    <meta name="description" content="Tr√≤ chuy·ªán v·ªõi AI th√¥ng minh, hi·ªÉu bi·∫øt v·ªÅ t√¢m l√Ω h·ªçc sinh Vi·ªát Nam. H·ªó tr·ª£ 24/7 trong kh√¥ng gian an to√†n.">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body class="bg-background font-inter text-text-primary antialiased overflow-hidden">
    <!-- Crisis Support Button - Always Accessible -->
    <div class="fixed top-4 right-4 z-50">
        <button id="crisis-btn" class="bg-error hover:bg-error-600 text-white px-4 py-2 rounded-full shadow-therapeutic breathing-transition flex items-center gap-2 text-sm font-medium">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
            </svg>
            H·ªó tr·ª£ kh·∫©n c·∫•p
        </button>
    </div>

    <!-- Header Navigation -->
    <header class="bg-surface/80 backdrop-blur-sm border-b border-border-light sticky top-0 z-40">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <svg class="h-8 w-8 text-primary" viewBox="0 0 32 32" fill="currentColor">
                            <path d="M16 2C8.268 2 2 8.268 2 16s6.268 14 14 14 14-6.268 14-14S23.732 2 16 2zm0 6c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zm0 18c-3.314 0-6.22-1.686-7.93-4.25C8.588 20.124 12.294 19 16 19s7.412 1.124 7.93 2.75C22.22 24.314 19.314 26 16 26z"/>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h1 class="text-xl font-be-vietnam font-semibold text-text-primary">B·∫°n Th∆∞∆°ng</h1>
                        <p class="text-xs text-text-secondary">AI Chat</p>
                    </div>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="homepage_therapeutic_digital_sanctuary.html" class="text-text-secondary hover:text-text-primary hover:bg-surface px-3 py-2 rounded-md text-sm font-medium breathing-transition">Trang ch·ªß</a>
                        <a href="ai_chat_interface_conversational_therapy.html" class="bg-primary text-white px-3 py-2 rounded-md text-sm font-medium">AI Chat</a>
                        <a href="t_m_s_m_ng_private_journal_space.html" class="text-text-secondary hover:text-text-primary hover:bg-surface px-3 py-2 rounded-md text-sm font-medium breathing-transition">T√¢m s·ª±</a>
                        <a href="progress_dashboard_emotional_growth_visualization.html" class="text-text-secondary hover:text-text-primary hover:bg-surface px-3 py-2 rounded-md text-sm font-medium breathing-transition">Ti·∫øn tr√¨nh</a>
                    </div>
                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden">
                    <button type="button" class="bg-surface inline-flex items-center justify-center p-2 rounded-md text-text-secondary hover:text-text-primary hover:bg-primary-50 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary" onclick="toggleMobileMenu()">
                        <svg class="block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Mobile Navigation Menu -->
        <div class="md:hidden hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 bg-surface border-t border-border-light">
                <a href="homepage_therapeutic_digital_sanctuary.html" class="text-text-secondary hover:text-text-primary hover:bg-primary-50 block px-3 py-2 rounded-md text-base font-medium">Trang ch·ªß</a>
                <a href="ai_chat_interface_conversational_therapy.html" class="bg-primary text-white block px-3 py-2 rounded-md text-base font-medium">AI Chat</a>
                <a href="t_m_s_m_ng_private_journal_space.html" class="text-text-secondary hover:text-text-primary hover:bg-primary-50 block px-3 py-2 rounded-md text-base font-medium">T√¢m s·ª± m·ªèng</a>
                <a href="h_nh_d_ng_t_i_thought_monsters_gamification.html" class="text-text-secondary hover:text-text-primary hover:bg-primary-50 block px-3 py-2 rounded-md text-base font-medium">H√¨nh d√°ng t√¥i</a>
                <a href="kh_m_ph_personalized_coping_discovery.html" class="text-text-secondary hover:text-text-primary hover:bg-primary-50 block px-3 py-2 rounded-md text-base font-medium">Kh√°m ph√°</a>
                <a href="progress_dashboard_emotional_growth_visualization.html" class="text-text-secondary hover:text-text-primary hover:bg-primary-50 block px-3 py-2 rounded-md text-base font-medium">Ti·∫øn tr√¨nh</a>
            </div>
        </div>
    </header>

    <!-- Main Chat Interface -->
    <main class="flex flex-col h-screen bg-gradient-to-br from-background to-surface" style="height: calc(100vh - 4rem);">
        <!-- Chat Header with Mood Indicator -->
        <div class="bg-white/80 backdrop-blur-sm border-b border-border-light px-4 py-3">
            <div class="flex items-center justify-between max-w-4xl mx-auto">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div>
                        <h2 class="font-be-vietnam font-medium text-text-primary">AI B·∫°n Th∆∞∆°ng</h2>
                        <p class="text-sm text-text-secondary flex items-center">
                            <span class="w-2 h-2 bg-success rounded-full mr-2 animate-gentle-pulse"></span>
                            ƒêang online
                        </p>
                    </div>
                </div>
                
                <!-- Mood Indicator -->
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-text-secondary">T√¢m tr·∫°ng:</span>
                    <div id="mood-indicator" class="px-3 py-1 rounded-full text-sm font-medium bg-primary-100 text-primary">
                        üòä Vui v·∫ª
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Messages Container -->
        <div id="chat-container" class="flex-1 overflow-y-auto px-4 py-6 space-y-4 max-w-4xl mx-auto w-full">
            <!-- Welcome Message -->
            <div class="flex items-start space-x-3 animate-therapeutic-fade">
                <div class="w-8 h-8 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center flex-shrink-0">
                    <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <div class="bg-white rounded-sanctuary p-4 shadow-gentle max-w-md">
                    <p class="text-text-primary font-be-vietnam leading-relaxed">
                        Ch√†o b·∫°n! M√¨nh l√† AI B·∫°n Th∆∞∆°ng. M√¨nh ·ªü ƒë√¢y ƒë·ªÉ l·∫Øng nghe v√† h·ªó tr·ª£ b·∫°n. 
                        B·∫°n c√≥ mu·ªën chia s·∫ª g√¨ v·ªõi m√¨nh kh√¥ng? üíô
                    </p>
                    <span class="text-xs text-text-secondary mt-2 block">V·ª´a xong</span>
                </div>
            </div>

            <!-- Suggested Conversation Starters -->
            <div class="flex flex-wrap gap-2 justify-center py-4">
                <button class="suggestion-btn px-4 py-2 bg-primary-50 hover:bg-primary-100 text-primary rounded-gentle text-sm breathing-transition border border-primary-200">
                    "H√¥m nay m√¨nh c·∫£m th·∫•y h∆°i cƒÉng th·∫≥ng..."
                </button>
                <button class="suggestion-btn px-4 py-2 bg-secondary-50 hover:bg-secondary-100 text-secondary rounded-gentle text-sm breathing-transition border border-secondary-200">
                    "M√¨nh mu·ªën t√¨m hi·ªÉu v·ªÅ b·∫£n th√¢n"
                </button>
                <button class="suggestion-btn px-4 py-2 bg-accent-50 hover:bg-accent-100 text-accent-700 rounded-gentle text-sm breathing-transition border border-accent-200">
                    "L√†m sao ƒë·ªÉ h·ªçc t·∫≠p hi·ªáu qu·∫£ h∆°n?"
                </button>
            </div>
        </div>

        <!-- Smart Suggestions Panel (Hidden by default) -->
        <div id="suggestions-panel" class="hidden bg-surface border-t border-border-light px-4 py-3">
            <div class="max-w-4xl mx-auto">
                <h3 class="text-sm font-medium text-text-secondary mb-2">G·ª£i √Ω cho b·∫°n:</h3>
                <div class="flex flex-wrap gap-2">
                    <button class="smart-suggestion px-3 py-1 bg-primary-100 hover:bg-primary-200 text-primary rounded-gentle text-sm breathing-transition">
                        üìù Vi·∫øt nh·∫≠t k√Ω
                    </button>
                    <button class="smart-suggestion px-3 py-1 bg-secondary-100 hover:bg-secondary-200 text-secondary rounded-gentle text-sm breathing-transition">
                        üé® T·∫°o qu√°i v·∫≠t suy nghƒ©
                    </button>
                    <button class="smart-suggestion px-3 py-1 bg-accent-100 hover:bg-accent-200 text-accent-700 rounded-gentle text-sm breathing-transition">
                        üßò B√†i t·∫≠p th·ªü
                    </button>
                </div>
            </div>
        </div>

        <!-- Message Input Area -->
        <div class="bg-white border-t border-border-light px-4 py-4">
            <div class="max-w-4xl mx-auto">
                <div class="flex items-end space-x-3">
                    <!-- Attachment Button -->
                    <button class="p-2 text-text-secondary hover:text-primary breathing-transition rounded-gentle hover:bg-primary-50">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8 4a3 3 0 00-3 3v4a5 5 0 0010 0V7a1 1 0 112 0v4a7 7 0 11-14 0V7a5 5 0 0110 0v4a3 3 0 11-6 0V7a1 1 0 012 0v4a1 1 0 102 0V7a3 3 0 00-3-3z" clip-rule="evenodd"/>
                        </svg>
                    </button>

                    <!-- Message Input -->
                    <div class="flex-1 relative">
                        <textarea 
                            id="message-input" 
                            placeholder="Chia s·∫ª c·∫£m x√∫c c·ªßa b·∫°n v·ªõi m√¨nh..."
                            class="w-full px-4 py-3 border border-border rounded-sanctuary focus:ring-2 focus:ring-primary focus:border-primary resize-none font-be-vietnam text-text-primary placeholder-text-secondary bg-background"
                            rows="1"
                            style="min-height: 48px; max-height: 120px;"
                        ></textarea>
                        
                        <!-- Character Count -->
                        <div class="absolute bottom-2 right-2 text-xs text-text-secondary">
                            <span id="char-count">0</span>/500
                        </div>
                    </div>

                    <!-- Send Button -->
                    <button 
                        id="send-btn" 
                        class="p-3 bg-primary hover:bg-primary-600 text-white rounded-sanctuary breathing-transition disabled:opacity-50 disabled:cursor-not-allowed"
                        disabled
                    >
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                        </svg>
                    </button>
                </div>

                <!-- Quick Actions -->
                <div class="flex items-center justify-between mt-3">
                    <div class="flex items-center space-x-4">
                        <button class="flex items-center space-x-1 text-text-secondary hover:text-primary breathing-transition text-sm">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.464 5.535a1 1 0 10-1.415-1.414 3 3 0 01-4.242 0 1 1 0 00-1.415 1.414 5 5 0 007.072 0z" clip-rule="evenodd"/>
                            </svg>
                            <span>C·∫£m x√∫c</span>
                        </button>
                        
                        <button id="voice-btn" class="flex items-center space-x-1 text-text-secondary hover:text-secondary breathing-transition text-sm">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"/>
                            </svg>
                            <span>Ghi √¢m</span>
                        </button>
                    </div>

                    <div class="flex items-center space-x-2 text-xs text-text-secondary">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                        </svg>
                        <span>Cu·ªôc tr√≤ chuy·ªán ƒë∆∞·ª£c m√£ h√≥a</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Crisis Support Modal -->
    <div id="crisis-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-sanctuary p-6 max-w-md w-full shadow-warm">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-error-100 rounded-full flex items-center justify-center mr-3">
                    <svg class="w-6 h-6 text-error" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <h3 class="text-lg font-be-vietnam font-semibold text-text-primary">H·ªó tr·ª£ kh·∫©n c·∫•p</h3>
            </div>
            
            <p class="text-text-secondary mb-6 leading-relaxed">
                N·∫øu b·∫°n ƒëang g·∫∑p kh·ªßng ho·∫£ng t√¢m l√Ω ho·∫∑c c√≥ √Ω ƒë·ªãnh t·ª± h·∫°i, h√£y li√™n h·ªá ngay v·ªõi c√°c ƒë∆∞·ªùng d√¢y n√≥ng:
            </p>
            
            <div class="space-y-3 mb-6">
                <a href="tel:18001567" class="flex items-center p-3 bg-error-50 rounded-gentle hover:bg-error-100 breathing-transition">
                    <svg class="w-5 h-5 text-error mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                    </svg>
                    <div>
                        <p class="font-medium text-error">ƒê∆∞·ªùng d√¢y n√≥ng t√¢m l√Ω</p>
                        <p class="text-sm text-text-secondary">1800 1567 (24/7)</p>
                    </div>
                </a>
                
                <a href="tel:113" class="flex items-center p-3 bg-warning-50 rounded-gentle hover:bg-warning-100 breathing-transition">
                    <svg class="w-5 h-5 text-warning mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                    </svg>
                    <div>
                        <p class="font-medium text-warning">C·∫•p c·ª©u kh·∫©n c·∫•p</p>
                        <p class="text-sm text-text-secondary">113</p>
                    </div>
                </a>
            </div>
            
            <div class="flex space-x-3">
                <button id="close-crisis-modal" class="flex-1 px-4 py-2 bg-surface hover:bg-border-light text-text-primary rounded-gentle breathing-transition">
                    ƒê√≥ng
                </button>
                <button class="flex-1 px-4 py-2 bg-primary hover:bg-primary-600 text-white rounded-gentle breathing-transition">
                    T√¨m chuy√™n gia
                </button>
            </div>
        </div>
    </div>

    <script>
        // Mobile menu toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        // Chat functionality
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const chatContainer = document.getElementById('chat-container');
        const charCount = document.getElementById('char-count');
        const suggestionsPanel = document.getElementById('suggestions-panel');

        // Auto-resize textarea
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            
            // Update character count
            const count = this.value.length;
            charCount.textContent = count;
            
            // Enable/disable send button
            sendBtn.disabled = count === 0 || count > 500;
            
            // Show suggestions if typing
            if (count > 10) {
                suggestionsPanel.classList.remove('hidden');
            } else {
                suggestionsPanel.classList.add('hidden');
            }
        });

        // Send message
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || message.length > 500) return;

            // Add user message
            addMessage(message, 'user');
            
            // Clear input
            messageInput.value = '';
            messageInput.style.height = 'auto';
            charCount.textContent = '0';
            sendBtn.disabled = true;
            suggestionsPanel.classList.add('hidden');

            // Simulate AI response
            setTimeout(() => {
                const responses = [
                    "C·∫£m ∆°n b·∫°n ƒë√£ chia s·∫ª v·ªõi m√¨nh. M√¨nh hi·ªÉu b·∫°n ƒëang c·∫£m th·∫•y nh∆∞ v·∫≠y. B·∫°n c√≥ mu·ªën k·ªÉ th√™m v·ªÅ ƒëi·ªÅu g√¨ ƒëang l√†m b·∫°n lo l·∫Øng kh√¥ng?",
                    "M√¨nh th·∫•y b·∫°n ƒëang tr·∫£i qua m·ªôt th·ªùi gian kh√≥ khƒÉn. ƒêi·ªÅu ƒë√≥ ho√†n to√†n b√¨nh th∆∞·ªùng v√† b·∫°n kh√¥ng ƒë∆°n ƒë·ªôc ƒë√¢u. H√£y c√πng m√¨nh t√¨m c√°ch ƒë·ªÉ b·∫°n c·∫£m th·∫•y t·ªët h∆°n nh√©.",
                    "B·∫°n ƒë√£ r·∫•t d≈©ng c·∫£m khi chia s·∫ª c·∫£m x√∫c c·ªßa m√¨nh. M√¨nh ·ªü ƒë√¢y ƒë·ªÉ l·∫Øng nghe v√† h·ªó tr·ª£ b·∫°n. B·∫°n c√≥ mu·ªën th·ª≠ m·ªôt s·ªë k·ªπ thu·∫≠t th∆∞ gi√£n kh√¥ng?",
                    "M√¨nh c·∫£m nh·∫≠n ƒë∆∞·ª£c s·ª± lo l·∫Øng trong l·ªùi n√≥i c·ªßa b·∫°n. H√£y th·ª≠ th·ªü s√¢u c√πng m√¨nh nh√© - h√≠t v√†o 4 gi√¢y, gi·ªØ 4 gi√¢y, th·ªü ra 6 gi√¢y. B·∫°n c√≥ c·∫£m th·∫•y tho·∫£i m√°i h∆°n kh√¥ng?"
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addMessage(randomResponse, 'ai');
                
                // Update mood based on conversation
                updateMoodIndicator();
            }, 1000 + Math.random() * 2000);
        }

        // Add message to chat
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex items-start space-x-3 animate-therapeutic-fade ${sender === 'user' ? 'flex-row-reverse space-x-reverse' : ''}`;
            
            const avatar = sender === 'user' 
                ? `<div class="w-8 h-8 bg-gradient-to-br from-accent to-primary rounded-full flex items-center justify-center flex-shrink-0">
                     <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                         <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                     </svg>
                   </div>`
                : `<div class="w-8 h-8 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center flex-shrink-0">
                     <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                         <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
                     </svg>
                   </div>`;

            const bubbleClass = sender === 'user' 
                ? 'bg-primary text-white rounded-sanctuary' 
                : 'bg-white rounded-sanctuary shadow-gentle';

            messageDiv.innerHTML = `
                ${avatar}
                <div class="${bubbleClass} p-4 max-w-md">
                    <p class="${sender === 'user' ? 'text-white' : 'text-text-primary'} font-be-vietnam leading-relaxed">${text}</p>
                    <span class="text-xs ${sender === 'user' ? 'text-primary-100' : 'text-text-secondary'} mt-2 block">V·ª´a xong</span>
                </div>
            `;

            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Update mood indicator
        function updateMoodIndicator() {
            const moods = [
                { emoji: 'üòä', text: 'Vui v·∫ª', class: 'bg-success-100 text-success' },
                { emoji: 'üòå', text: 'B√¨nh th·∫£n', class: 'bg-secondary-100 text-secondary' },
                { emoji: 'ü§î', text: 'Suy nghƒ©', class: 'bg-primary-100 text-primary' },
                { emoji: 'üòî', text: 'Bu·ªìn b√£', class: 'bg-warning-100 text-warning' }
            ];
            
            const randomMood = moods[Math.floor(Math.random() * moods.length)];
            const moodIndicator = document.getElementById('mood-indicator');
            moodIndicator.textContent = `${randomMood.emoji} ${randomMood.text}`;
            moodIndicator.className = `px-3 py-1 rounded-full text-sm font-medium ${randomMood.class}`;
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Suggestion buttons
        document.querySelectorAll('.suggestion-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                messageInput.value = this.textContent.replace(/"/g, '');
                messageInput.focus();
                messageInput.dispatchEvent(new Event('input'));
            });
        });

        // Smart suggestions
        document.querySelectorAll('.smart-suggestion').forEach(btn => {
            btn.addEventListener('click', function() {
                const text = this.textContent;
                if (text.includes('nh·∫≠t k√Ω')) {
                    window.location.href = 't_m_s_m_ng_private_journal_space.html';
                } else if (text.includes('qu√°i v·∫≠t')) {
                    window.location.href = 'h_nh_d_ng_t_i_thought_monsters_gamification.html';
                } else if (text.includes('th·ªü')) {
                    addMessage('H√£y c√πng m√¨nh th·ª±c hi·ªán b√†i t·∫≠p th·ªü nh√©: H√≠t v√†o 4 gi√¢y... gi·ªØ 4 gi√¢y... th·ªü ra 6 gi√¢y. L·∫∑p l·∫°i 5 l·∫ßn.', 'ai');
                }
            });
        });

        // Crisis support modal
        const crisisBtn = document.getElementById('crisis-btn');
        const crisisModal = document.getElementById('crisis-modal');
        const closeCrisisModal = document.getElementById('close-crisis-modal');

        crisisBtn.addEventListener('click', () => {
            crisisModal.classList.remove('hidden');
        });

        closeCrisisModal.addEventListener('click', () => {
            crisisModal.classList.add('hidden');
        });

        crisisModal.addEventListener('click', (e) => {
            if (e.target === crisisModal) {
                crisisModal.classList.add('hidden');
            }
        });

        // Voice recording (placeholder)
        document.getElementById('voice-btn').addEventListener('click', function() {
            this.classList.toggle('text-error');
            if (this.classList.contains('text-error')) {
                this.innerHTML = `
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a2 2 0 114 0v4a2 2 0 11-4 0V7z" clip-rule="evenodd"/>
                    </svg>
                    <span>ƒêang ghi...</span>
                `;
            } else {
                this.innerHTML = `
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"/>
                    </svg>
                    <span>Ghi √¢m</span>
                `;
            }
        });

        // Initialize mood from homepage if available
        const savedMood = localStorage.getItem('currentMood');
        if (savedMood) {
            const moodMap = {
                'happy': { emoji: 'üòä', text: 'Vui v·∫ª', class: 'bg-success-100 text-success' },
                'calm': { emoji: 'üòå', text: 'B√¨nh th·∫£n', class: 'bg-secondary-100 text-secondary' },
                'stressed': { emoji: 'üò∞', text: 'CƒÉng th·∫≥ng', class: 'bg-warning-100 text-warning' },
                'sad': { emoji: 'üò¢', text: 'Bu·ªìn b√£', class: 'bg-error-100 text-error' }
            };
            
            const mood = moodMap[savedMood];
            if (mood) {
                const moodIndicator = document.getElementById('mood-indicator');
                moodIndicator.textContent = `${mood.emoji} ${mood.text}`;
                moodIndicator.className = `px-3 py-1 rounded-full text-sm font-medium ${mood.class}`;
            }
        }
    </script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
<script id="dhws-elementInspector" src="../public/dhws-web-inspector.js"></script>
<script id="dhws-errorTracker" src="../public/dhws-error-tracker.js"></script>
</body>
</html>